function createDB(t,e,n,i){void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=null);var r=dragonBones.EgretFactory.factory;if(r.getDragonBonesData(t)){var o=r.buildArmatureDisplay(t);return n&&n.apply(i,[o]),o}var s=void 0,a=void 0,h=void 0,c=["_ske_json","_tex_json","_tex_png"];[RES.ResourceItem.TYPE_JSON,RES.ResourceItem.TYPE_JSON,RES.ResourceItem.TYPE_IMAGE];if(s=RES.getRes(t+c[0]),a=RES.getRes(t+c[1]),h=RES.getRes(t+c[2]),null==s||null==a||null==h)return null;var u=dragonBones.EgretFactory.factory;u.parseDragonBonesData(s),u.parseTextureAtlasData(a,h);var o=u.buildArmatureDisplay(t);return n&&n.apply(i,[o]),o}function FstringToByte(t){var e,n,i=new Array;e=t.length;for(var r=0;e>r;r++)n=t.charCodeAt(r),n>=65536&&1114111>=n?(i.push(n>>18&7|240),i.push(n>>12&63|128),i.push(n>>6&63|128),i.push(63&n|128)):n>=2048&&65535>=n?(i.push(n>>12&15|224),i.push(n>>6&63|128),i.push(63&n|128)):n>=128&&2047>=n?(i.push(n>>6&31|192),i.push(63&n|128)):i.push(255&n);return i}function Base64decode(t){var e,n,i,r,o,s,a,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",u=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<t.length;)r=h.indexOf(t.charAt(u++)),o=h.indexOf(t.charAt(u++)),s=h.indexOf(t.charAt(u++)),a=h.indexOf(t.charAt(u++)),e=r<<2|o>>4,n=(15&o)<<4|s>>2,i=(3&s)<<6|a,c+=String.fromCharCode(e),64!=s&&(c+=String.fromCharCode(n)),64!=a&&(c+=String.fromCharCode(i));return c=_utf8_decode(c)}function Log(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}function fullScreen(){var t=document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()}function changeTextColor(t,e,n){t.textColor=n,Number(t.text)>e&&(t.textColor=14889265)}function numberToText(t){t=Number(t);var e=t+"",n="";t>1e8?(t/=1e8,n="亿"):t>1e4&&(t/=1e4,n="万"),e=t+"";var i="0";return e.split(".").length>1&&(i=e.split(".")[1].substr(0,1)),e="0"==i?e.split(".")[0]+n:e.split(".")[0]+"."+i+n}function toThousands(t){for(var e=(Math.abs(t)||0).toString(),n="";e.length>3;)n=","+e.slice(-3)+n,e=e.slice(0,e.length-3);return e&&(n=e+n),0>t&&(n="-"+n),n}function numberToStr(t){for(var e=["","k","m","b","t","aa","ab","ac","ad","ae","af","ag","ah","ai","aj","ak","al","am","an","ao","ap","aq","ar","as","at","au","av","aw","ax","ay","az","ba","bb","bc","bd","be","bf","bg","bh","bi","bj","bk","bl","bm","bn","bo","bp","bq","br","bd","bt","bu","bv","bw","bx","by","bz","ca","cb","cc","cd","ce","cf","cg","ch","ci","cj","ck","cl","cm","cn"],n=1,i=t/1e3;i>=1;)n++,i/=1e3;var r=1e5*i/100+"",o=r.split(".")[0],s=r.split(".")[1];if(s){var a=s.substring(0,3-o.length);""!=a&&"0"!=a&&(o+="."+a)}var h=o+e[n-1];return 1==n&&(h=Math.ceil(t)+""),h}function strToNumber(t){var e=["","k","m","b","t","aa","ab","ac","ad","ae","af","ag","ah","ai","aj","ak","al","am","an","ao","ap","aq","ar","as","at","au","av","aw","ax","ay","az","ba","bb","bc","bd","be","bf","bg","bh","bi","bj","bk","bl","bm","bn","bo","bp","bq","br","bd","bt","bu","bv","bw","bx","by","bz","ca","cb","cc","cd","ce","cf","cg","ch","ci","cj","ck","cl","cm","cn"],n=0;for(n;n<t.length;n++){var i=t[n];if(i>="a"&&"z">=i)break}var r=Number(t.substring(0,n)),o=0;n<=t.length&&(o=e.indexOf(t.substring(n,t.length)));for(var s=0;o>s;s++)r*=1e3;return r}function playSound(t){var e=RES.getRes(t+"_mp3");e&&(soundc&&soundc.stop(),soundc=e.play(0,1))}function changeStrToImg(t,e,n,i,r){void 0===i&&(i=1),void 0===r&&(r=!0),r&&n.removeChildren();for(var o=0;o<e.length;o++){var s=e.substring(o,o+1),a=new eui.Image;switch(s){case".":case":":a.source=RES.getRes("numberG_dian_png");break;case"万":a.source=RES.getRes(t+"_wan_png");break;case"亿":a.source=RES.getRes(t+"_yi_png");break;default:"A">s||s>"Z"?a.source=RES.getRes(t+"_"+s+"_png"):a.source=RES.getRes(t+"_"+s+"2_png")}null==a.source&&(a.width=10),a.scaleX=a.scaleY=i,n.addChild(a)}}function saveLocalData(t,e,n){void 0===n&&(n=-1);var i=GameData.GAMENAME+t;e=e+"@TIME:"+Date.now()+"@TIME:"+n,egret.localStorage.setItem(i,e)}function readLocalData(t){var e=GameData.GAMENAME+t,n=egret.localStorage.getItem(e);return n&&null!=n?-1!=Number(n.split("@TIME:")[2])&&Date.now()-Number(n.split("@TIME:")[1])>=Number(n.split("@TIME:")[2])?(egret.localStorage.removeItem(e),null):n.split("@TIME:")[0]:null}function clearLocalData(t){var e=GameData.GAMENAME+t;null!=e?egret.localStorage.removeItem(e):egret.localStorage.clear()}function getrect(t,e){var n=t.getBounds();return n.x=t.x-e.x,n.y=t.y-e.y,n}function createRect(t,e,n,i,r,o,s,a){void 0===r&&(r=1),void 0===o&&(o=0),void 0===s&&(s=0);var h=new egret.Shape;return h.x=t,h.y=e,h.graphics.beginFill(o,r),h.graphics.drawRoundRect(0,0,n,i,s,a),h.graphics.endFill(),h}function createCircle(t,e,n,i,r){void 0===i&&(i=1),void 0===r&&(r=0);var o=new egret.Shape;return o.graphics.beginFill(r,i),o.graphics.drawCircle(t,e,n),o.graphics.endFill(),o}function createMC(t,e,n){var i=RES.getRes(t),r=RES.getRes(e),o=new egret.MovieClipDataFactory(i,r),s=o.generateMovieClipData(n),a=new egret.MovieClip(s);return a}function createBitmap(t,e,n){void 0===e&&(e=.5),void 0===n&&(n=.5);var i=new egret.Bitmap;return i.texture=RES.getRes(t),i.anchorOffsetX=i.width*e,i.anchorOffsetY=i.height*n,i}function initSHlider(t,e,n){t.minimum=e,t.maximum=n,t.value=1}function compare(t,e){return void 0===e&&(e=!1),function(n,i){var r=n[t],o=i[t];return isNaN(Number(r))||isNaN(Number(o))||(r=Number(r),o=Number(o)),e?r>o?1:o>r?-1:0:o>r?1:r>o?-1:0}}function setStrLength(t,e,n){var i=t,r=n?e+n.length:e;return i.length>r&&(i=i.substr(0,e),n&&(i+=n)),i}function setStrLengthByLable(t,e,n){var i=t.text;return t.textWidth>e&&(i=i.substr(0,i.length-Math.floor((t.width-e)/(t.width/i.length))),n&&(i+=n)),i}function copyCode(t){var e=t,n=document.getElementById("copy_text");n.innerHTML=e,n.readOnly=!1,n.select(),n.setSelectionRange(0,n.value.length),document.execCommand("copy"),n.readOnly=!0}function exportclass(){var t="configcookexpend",e="烹饪台升级消耗系数",n={beizhu:"",id:1,isRepeat:1,maxRandomTime:12,shopId:"1001,1002,1003,1004,1005,1006",weight:100},i="/**\n* "+e+"配置表\n*/\nexport class "+t+" {\n";for(var r in n)i+="public "+r+": "+typeof n[r]+";\n";return i+="}\n\n",i+="//"+e+"配置表\n",i+="public static "+t+"List:Array<jsondata.config."+t+"> = [];\n\n",i+="//"+e+"配置表\nthis.writeConfig(receiveJson."+t+", this."+t+'List);\nLog("'+e+'配置表", this.'+t+"List);",Log(i),i}function gcd(t,e){var n=Math.min(t,e),i=Math.max(t,e),r=1;if(0===t||0===e)return i;for(var o=n;o>=1;o--)if(n%o===0&&i%o===0){r=o;break}return r}function weight_rand(t){for(var e,n=0,i=!1,r=new Array,o=0;o<t.length;o++)"undefined"!=typeof t[o].weight?-1!==t[o].weight.toString().indexOf("%")?(e=Math.floor(t[o].weight.toString().replace("%","")),i=!0):e=Math.floor(100*t[o].weight):e=0,r[o]=e,n=gcd(n,e);var s=new Array,a=0,h=0;if(i){for(var o=0;o<t.length;o++){h=r[o];for(var c=0;h>c&&!(a>=100);c++)s.push(o),a++}for(;100>a;)s.push(t.length-1),a++}else for(o=0;o<t.length;o++){for(h=r[o]/n,c=0;h>c;c++)s.push(o);a+=h}var u=Math.floor(Math.random()*a);return t[s[u]]}function pauseSound(){}function rusumeSound(){}function readZip(t,e,n,i){}function numberToTime(t,e){void 0===e&&(e=0),t=Math.floor(Number(t)/1e3);var n=(Math.floor(t/86400),Math.floor(t/3600)%24),i=Math.floor(t/60)%60,r=Math.floor(t%60);return 0==e?0==n?fillzero(i)+":"+fillzero(r):fillzero(n)+":"+fillzero(i)+":"+fillzero(r):1==e?0==n?"00:"+fillzero(i)+":"+fillzero(r):fillzero(n)+":"+fillzero(i)+":"+fillzero(r):2==e?(n=Math.floor(t/3600),0==n?"00:"+fillzero(i)+":"+fillzero(r):fillzero(n)+":"+fillzero(i)+":"+fillzero(r)):void 0}function fillzero(t){return 10>t?"0"+t:""+t}function changetime(t){t=1e3*Number(t);var e=new Date(t);return 86400-(60*e.getHours()*60+60*e.getMinutes()+e.getSeconds())}function checkSameDay(t,e){var n=new Date(t),i=new Date(e);return n.getFullYear()==i.getFullYear()&&n.getMonth()==i.getMonth()&&n.getDate()==i.getDate()?!0:!1}function TimeTonumber(t){var e=t.split(":"),n=3600*Number(e[0]),i=60*Number(e[1]),r=Number(e[2]);return n+i+r}function wait(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,n){setTimeout(function(){e()},t)})]})})}function checkPhone(t){return/^1[3456789]\d{9}$/.test(t)?!0:!1}function checkPassword(t){return/^(\w){6,8}$/.exec(t)?!0:!1}function drawGradient(t,e){var n=new egret.Shape;n.width=t,n.height=e;var i=n.matrix;return i.a=i.d=1,i.c=i.b=0,n.graphics.beginGradientFill(egret.GradientType.RADIAL,[16777215,6139133],[0,1],[0,30],i),n.graphics.drawRoundRect(0,0,n.width,n.height,0,0),n.graphics.endFill(),n}var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{h(i.next(t))}catch(e){o(e)}}function a(t){try{h(i["throw"](t))}catch(e){o(e)}}function h(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,a)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,o&&(s=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(o,n[1])).done)return s;switch(o=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,o=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){h.label=n[1];break}if(6===n[0]&&h.label<s[1]){h.label=s[1],s=n;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(n);break}s[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(i){n=[6,i],o=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,o,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},cor;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.eventList=[],e.tweenList=[],e.dbList=[],e.touchEnabled=!1,e.width=GameData.GameWidth,e.height=GameData.GameHeigth,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeFromStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){},e.prototype.removeFromStage=function(){this.removeDB(),this.removeEvent(),this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFromStage,this)},e.prototype.setFontFamily=function(t){},e.prototype.showVb=function(){this.visible=!0,this.show()},e.prototype.show=function(t){},e.prototype.hide=function(){this.visible=!1},e.prototype.addDB=function(t,e){var n=createDB(e);n.x=n.width/2,t.addChild(n),n.animation.play(),this.dbList.push({db:n,target:t})},e.prototype.addEvent=function(t,e,n,i,r){var o={target:t,event:e,obj:n,fun:i,parmar:r};this.eventList.push(o),t.addEventListener(e,this.touchEnd,n)},e.prototype.touchEnd=function(t){var e;for(var n in this.eventList)if(this.eventList[n].target==t.currentTarget&&this.eventList[n].event==t.type){e=this.eventList[n];break}e.parmar?e.parmar.push(t):e.parmar=[t],e.fun.apply(e.obj,e.parmar)},e.prototype.removeEvent=function(t){if(t){var e=void 0;for(var n in this.eventList)if(this.eventList[n].target==t){e=this.eventList[n];break}e&&(e.target.removeEventListener(e.event,this.touchEnd,e.obj),this.eventList.splice(this.eventList.indexOf(e),1))}else{for(var i=0;i<this.eventList.length;i++){var e=this.eventList[i];e.target.removeEventListener(e.event,this.touchEnd,e.obj)}this.eventList=[]}},e.prototype.removeDB=function(t){for(var e=!1,n=this.dbList.length-1;n>=0;n--){var i=this.dbList[n].db;if(t&&i.armature.name==t){i.dispose(),this.dbList[n].target.removeChild(i),this.dbList.splice(n,1),e=!0;break}i.dispose(),this.dbList[n].target.removeChild(i)}e||(this.dbList=[])},e.prototype.dispose=function(){this.parent&&this.parent.removeChild(this)},e}(eui.Component);t.BaseScene=e,__reflect(e.prototype,"cor.BaseScene")}(cor||(cor={}));var Game;!function(t){var e=function(t){function e(e,n){var i=t.call(this)||this;return i.skinName="RecodePage",i.init(e,n),i.initEvent(),i}return __extends(e,t),e.prototype.init=function(t,e){this.recode_scroller.height=this.height-164,"GST"==e?this._gst_recodeInfo||(this._gst_recodeInfo=t):this._usdt_recodeInfo||(this._usdt_recodeInfo=t),this._recodeInfo=t,this.showInfo(e)},e.prototype.showInfo=function(t){"GST"==t?(this.gst_info_btn.currentState="up",this.usdt_info_btn.currentState="down"):(this.gst_info_btn.currentState="down",this.usdt_info_btn.currentState="up");var e=this._recodeInfo;for(var n in e){var i=e[n],r=Number(i.change_amount)>=0?"+":"";i.cacolor=Number(i.change_amount)>=0?4042751:0,i.change_amount=r+Math.round(Number(i.change_amount)),i.after_amount=i.after_amount?i.coin_name+"余额  "+Math.round(Number(i.after_amount)):""}this.recode_list.dataProvider=new eui.ArrayCollection(this._recodeInfo)},e.prototype.initEvent=function(){this.addEvent(this.close_btn,egret.TouchEvent.TOUCH_TAP,this,this.dispose),this.addEvent(this.gst_info_btn,egret.TouchEvent.TOUCH_TAP,this,this.gst_info),this.addEvent(this.usdt_info_btn,egret.TouchEvent.TOUCH_TAP,this,this.usdt_info)},e.prototype.gst_info=function(){var t=this;cor.Socket.getIntance().sendmsg("TRANSACTION_RECORDS",{coin_name:"GST",page:1,page_size:100},function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){return Log(e),this._recodeInfo=this._gst_recodeInfo=e,this.showInfo("GST"),[2]})})},this)},e.prototype.usdt_info=function(){var t=this;cor.Socket.getIntance().sendmsg("TRANSACTION_RECORDS",{coin_name:"USDT",page:1,page_size:100},function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){return Log(e),this._recodeInfo=this._usdt_recodeInfo=e,this.showInfo("USDT"),[2]})})},this)},e}(cor.BaseScene);t.RecodePage=e,__reflect(e.prototype,"Game.RecodePage")}(Game||(Game={}));var cor;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.sendEvent=function(t,e){this.dispatchEventWith(t,!1,e)},e.instance=function(){return this._i||(this._i=new e)},e}(egret.EventDispatcher);t.EventManage=e,__reflect(e.prototype,"cor.EventManage")}(cor||(cor={}));var GameData=function(){function t(){}return t.GAMENAME="RichManGame",t.GameDesignWidth=750,t.GameDesignHeigth=1334,t.GameWidth=750,t.GameHeigth=1334,t.WidthOFFX=0,t.HeigthOFFY=0,t.ServerUrl="http://47.107.80.152:8082/",t.ServerSocketUrl="ws://148.70.80.204:9001/app",t.BGame=!1,t.UserPhone="",t.UserPassword="",t.UserInfo={nickname:"",picture:"",identity:1,invitation_code:"",is_bind_mobile:!0,mobile:"",is_bind_wx:!1,experience:0,grade:"1级",designation:"初级学徒",sex:1,birthday:"",gts_number:0,mineral:0,current_grade_max_experience:2427,current_hold_area_grade:1,dig_time:-1,current_hold_area_code:""},t}();__reflect(GameData.prototype,"GameData");var UserPhone="UserPhone",UserPassword="UserPassword",UpdataUserInfo="UpdataUserInfo",ChangeIdentity="ChangeIdentity",ExitGame="ExitGame",NEW_NOTICE="NEW_NOTICE",GameMusic="GameMusic",UpdataGameInfo="UpdataGameInfo",StartDigMine="StartDigMine",DigMineTime="DigMineTime",SEX;!function(t){t[t.Man=1]="Man",t[t.Woman=2]="Woman"}(SEX||(SEX={}));var IDENTITY;!function(t){t[t.Miner=1]="Miner",t[t.Owner=2]="Owner"}(IDENTITY||(IDENTITY={}));var ENGINE_TYPE;!function(t){t[t.EXCAVATE=1]="EXCAVATE",t[t.PANNING=2]="PANNING"}(ENGINE_TYPE||(ENGINE_TYPE={}));var Game;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="LoadingLogo",e.isEnd=!1,e.init(),e.initEnent(),e}return __extends(e,t),e.prototype.init=function(){var t=this;egret.Tween.get(this.logo).to({alpha:1},500).call(function(){t.isEnd=!0})},e.prototype.initEnent=function(){},e.prototype.hideAndShow=function(t,e){var n=this;this.isEnd?egret.Tween.get(this.logo).to({alpha:0},500).call(function(){n.dispose(),t.apply(e)}):setTimeout(function(){egret.Tween.get(n.logo).to({alpha:0},500).call(function(){n.dispose(),t.apply(e)})},500)},e}(cor.BaseScene);t.LoadingLogo=e,__reflect(e.prototype,"Game.LoadingLogo")}(Game||(Game={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Game;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="LoadingView",e._index=0,e.init(),e.initEnent(),e}return __extends(e,t),e.prototype.init=function(){this.loadingTx.text="",this.tipTx.text="",this.loadingBar.width=0,this._index=0,this.showTip()},e.prototype.showTip=function(){var t=this,e=["欢迎来到Richman大矿场","正在招聘专属矿区管家","马上就要抵达目的地，请稍等","越大的矿区，越能产出更多的矿石","想要快速挖到矿石，试不试配置齐全设备","矿石交易所的交易价格会不定时更新，请一定留意好每日的价格走势"];this.tipTx.text=e[this._index],this._tag=setTimeout(function(){t._index=(t._index+1)%e.length,t.showTip()},1500)},e.prototype.initEnent=function(){},e.prototype.onProgress=function(t,e){this.loadingTx.text="Loading..."+Math.floor(t/e*100)+"%",this.loadingBar.width=600*(t/e)},e.prototype.dispose=function(){clearTimeout(this._tag),this.parent.removeChild(this)},e}(cor.BaseScene);t.LoadingView=e,__reflect(e.prototype,"Game.LoadingView",["RES.PromiseTaskReporter"])}(Game||(Game={}));var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){return t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){},e=new AssetAdapter,egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),egret.ExternalInterface.call("sendToNative","init$0"),egret.ExternalInterface.addCallback("sendToJS",function(t){var e=t.split("$")[0],n=t.split("$")[1];switch(e){case"init":platform.name=n}}),egret.ImageLoader.crossOrigin="anonymous",this.runGame()["catch"](function(t){console.log(t)}),[2]})})},e.prototype.setAddapter=function(){new Promise(function(t,e){return egret.MainContext.instance.stage.orientation=egret.OrientationMode.PORTRAIT,egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,GameData.GameWidth=egret.MainContext.instance.stage.stageWidth,GameData.GameHeigth=egret.MainContext.instance.stage.stageHeight,t()})},e.prototype.onStageResize=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.setAddapter()];case 1:return t.sent(),[2]}})})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.setAddapter()];case 1:return t.sent(),[4,this.loadResource()];case 2:return t.sent(),this.showLogo(),[4,RES.loadGroup("preload",0)];case 3:return t.sent(),this.loadinglogo.hideAndShow(this.createGameScene,this),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return e.sent(),[4,this.loadTheme()];case 2:return e.sent(),[4,RES.loadGroup("loadlogo",0)];case 3:return e.sent(),"web"!=platform.name&&egret.registerFontMapping("myFont","resource/font/fanti.ttf"),[3,5];case 4:return t=e.sent(),console.error(t),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.showLogo=function(){this.loadinglogo=new Game.LoadingLogo,this.addChild(this.loadinglogo)},e.prototype.createGameScene=function(){this.addChild(cor.MainScene.instance()),this.addChild(Game.TipsSkin.instance());var t=new Game.LoginSkin;cor.MainScene.instance().addChild(t),cor.Socket.getIntance().ProConnet()},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},e}(eui.UILayer);__reflect(Main.prototype,"Main");var cor;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return egret.ExternalInterface.addCallback("back",function(t){if(1==e.numChildren)egret.ExternalInterface.call("sendToNative","exit$0");else if(GameData.BGame);else{var n=e.numChildren-1,i=e.getChildAt(n);i.dispose()}}),e}return __extends(e,t),e.prototype.clearPage=function(){if(this.numChildren>1)for(var t=this.numChildren-1;t>0;t--){var e=this.getChildAt(t);e.dispose()}},e.prototype.clearScene=function(){for(var t=this.numChildren-1;t>=0;t--){var e=this.getChildAt(t);e.dispose()}},e.instance=function(){return this._i||(this._i=new e)},e}(egret.DisplayObjectContainer);t.MainScene=e,__reflect(e.prototype,"cor.MainScene")}(cor||(cor={}));var GameUtil;!function(t){var e=function(t){function e(e,n,i){var r=t.call(this)||this;return r.init(e,n,i),r}return __extends(e,t),e.prototype.init=function(t,e,n){this.texture=t,this.$setX(e),this.$setY(n),this.setanchorOff(.5,.5)},e.prototype.setNewTexture=function(t){this.texture=t},e.prototype.setanchorOff=function(t,e){this.anchorOffsetX=this.$getWidth()*t,this.anchorOffsetY=this.$getHeight()*e},e}(egret.Bitmap);t.MyBitmap=e,__reflect(e.prototype,"GameUtil.MyBitmap")}(GameUtil||(GameUtil={}));var DebugPlatform=function(){function t(){this.name="web"}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function r(t){e.call(i,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),n.call(i))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(i,generateJSON.paths[t])},this):RES.getResByUrl(h,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(i,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Game;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="TipsSkin",e.init(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeFromStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){},e.prototype.removeFromStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFromStage,this)},e.prototype.init=function(){this.visible=!1,this.anchorOffsetX=375,this.anchorOffsetY=49},e.prototype.show=function(t,e){var n=this;void 0===e&&(e=!0),this.x=egret.MainContext.instance.stage.stageWidth/2,this.y=egret.MainContext.instance.stage.stageHeight/2,egret.Tween.removeTweens(this),this.visible=!0,this.tipsLabel.text=t,this.alpha=1,e&&egret.Tween.get(this).wait(300).to({alpha:0},500).call(function(){n.hide()})},e.prototype.hide=function(){this.visible=!1},e.instance=function(){return this._i||(this._i=new e)},e}(eui.Component);t.TipsSkin=e,__reflect(e.prototype,"Game.TipsSkin")}(Game||(Game={}));var _utf8_encode=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var i=t.charCodeAt(n);128>i?e+=String.fromCharCode(i):i>127&&2048>i?(e+=String.fromCharCode(i>>6|192),e+=String.fromCharCode(63&i|128)):(e+=String.fromCharCode(i>>12|224),e+=String.fromCharCode(i>>6&63|128),e+=String.fromCharCode(63&i|128))}return e},_utf8_decode=function(t){for(var e,n,i,r="",o=0,s=e=n=0;o<t.length;)s=t.charCodeAt(o),128>s?(r+=String.fromCharCode(s),o++):s>191&&224>s?(n=t.charCodeAt(o+1),r+=String.fromCharCode((31&s)<<6|63&n),o+=2):(n=t.charCodeAt(o+1),i=t.charCodeAt(o+2),r+=String.fromCharCode((15&s)<<12|(63&n)<<6|63&i),o+=3);return r},soundc,RandomUtils=function(){function t(){}return t.limit=function(t,e){t=Math.min(t,e),e=Math.max(t,e);var n=e-t;return t+Math.random()*n},t.limitInteger=function(t,e){return Math.floor(this.limit(t,e+1))},t.getElementInArray=function(t){var e=Math.floor(Math.random()*t.length);return t[e]},t.randomArray=function(t){for(var e=0;e<t.length;e++){var n=Math.round(Math.random()*(t.length-1-e))+e;i=[t[n],t[e]],t[e]=i[0],t[n]=i[1]}return t;var i},t}();__reflect(RandomUtils.prototype,"RandomUtils");var HtmlToJson=function(){function t(){this.initReplaceArr()}return t.prototype.initReplaceArr=function(){this.replaceArr=[],this.replaceArr.push([/&lt;/g,"<"]),this.replaceArr.push([/&gt;/g,">"]),this.replaceArr.push([/&amp;/g,"&"]),this.replaceArr.push([/&quot;/g,'"']),this.replaceArr.push([/&apos;/g,"'"]),this.replaceArr.push([/br;/g,"\n"])},t.prototype.replaceSpecial=function(t){for(var e=0;e<this.replaceArr.length;e++){var n=this.replaceArr[e][0],i=this.replaceArr[e][1];t=t.replace(n,i)}return t},t.prototype.parse=function(t){this.stackArray=[],this.resutlArr=[];for(var e=0,n=t.length;n>e;){var i=t.indexOf("<",e);if(0>i)this.addToResultArr(t.substring(e)),e=n;else{this.addToResultArr(t.substring(e,i));var r=t.indexOf(">",i);-1==r?(egret.$error(1038),r=i):"/"==t.charAt(i+1)?("/p"==t.substring(i+1,r)&&(this.resutlArr.length>0?this.resutlArr[this.resutlArr.length-1].text+="\n":this.resutlArr.push({text:"\n"})),this.stackArray.pop()):this.addToArray(t.substring(i+1,r)),e=r+1}}return this.resutlArr},t.prototype.addToResultArr=function(t){""!=t&&(t=this.replaceSpecial(t),this.stackArray.length>0?this.resutlArr.push({text:t,style:this.stackArray[this.stackArray.length-1]}):this.resutlArr.push({text:t}))},t.prototype.addToArray=function(t){var e=this.changeStringToObject(t);if(0==this.stackArray.length)this.stackArray.push(e);else{var n=this.stackArray[this.stackArray.length-1];for(var i in n)null==e[i]&&(e[i]=n[i]);this.stackArray.push(e)}},t.prototype.changeStringToObject=function(t){t=t.trim();var e={},n=[];if(n=t.match(/^(span|a|br)\s/)){var i=n[1];"br"==i&&(this.resutlArr.length>0?this.resutlArr[this.resutlArr.length-1].text+="\n":this.resutlArr.push({text:"\n"})),t=t.substring(n[0].length).trim();var r=t.split(";");r[0]=r[0].replace("style=","").substr(1);for(var o=0;o<r.length;o++){t=r[o].replace(":","=");for(var s=0,a=void 0;a=t.match(this.getHeadReg());){var h=a[0],c="";t=t.substring(h.length).trim(),'"'==t.charAt(0)?(s=t.indexOf('"',1),c=t.substring(1,s),s+=1):"'"==t.charAt(0)?(s=t.indexOf("'",1),c=t.substring(1,s),s+=1):(c=t.match(/(\S)+/)[0],s=c.length),this.addProperty(e,h.substring(0,h.length-1).trim(),c.trim()),t=t.substring(s).trim()}}}return e},t.prototype.getHeadReg=function(){return/^(font-size|color|textcolor|strokecolor|stroke|b|bold|i|italic|u|size|fontfamily|href|target)(\s)*=/},t.prototype.addProperty=function(t,e,n){switch(e.toLowerCase()){case"color":case"textcolor":n=n.replace(/#/,"0x"),t.textColor=parseInt(n);break;case"strokecolor":n=n.replace(/#/,"0x"),t.strokeColor=parseInt(n);break;case"stroke":t.stroke=parseInt(n);break;case"b":case"bold":t.bold="true"==n;break;case"u":t.underline="true"==n;break;case"i":case"italic":t.italic="true"==n;break;case"size":case"font-size":t.size=parseInt(n);break;case"fontfamily":t.fontFamily=n}},t.getInstence=function(){return this._i?this._i:this._i=new t},t._i=null,t}();__reflect(HtmlToJson.prototype,"HtmlToJson");var GUID=function(){function t(){this._list={}}return t.prototype.GUID=function(){do var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)});while(!this.register(t));return t},t.prototype.create=function(){return this.GUID()},t.prototype.getlist=function(){var t=[];for(var e in this._list)t.push(e);return t},t.prototype.setlist=function(t){this._list={};for(var e=0;e<t.length;e++)this._list[t[e]]=1},t.prototype.exists=function(t){return!!this._list[t]},t.prototype.register=function(t){return this.exists(t)?!1:(this._list[t]=1,!0)},t}();__reflect(GUID.prototype,"GUID");var Game;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="HomePage",t.banner_currentIndex=0,t.banner_touch_bx=0,t.banner_urls=[],t.init(),t.initEnent(),t.getNews(),t.getBanners(),t}return __extends(n,e),n.prototype.init=function(){this.news_scroller.height=this.height-100-this.news_scroller.y,this.home_btn.currentState="down",this.currentNav=this.home_btn,this.cureentPage=this.home_group,this.headImg.mask=this.headMask},n.prototype.initEnent=function(){this.addEvent(this.home_btn,egret.TouchEvent.TOUCH_TAP,this,this.showHome),this.addEvent(this.news_btn,egret.TouchEvent.TOUCH_TAP,this,this.showNews),this.addEvent(this.exchange_btn,egret.TouchEvent.TOUCH_TAP,this,this.showExchange),this.addEvent(this.personal_btn,egret.TouchEvent.TOUCH_TAP,this,this.showPersonal),this.addEvent(this.banner_group,egret.TouchEvent.TOUCH_BEGIN,this,this.banner_touch_begin),this.addEvent(this.banner_group,egret.TouchEvent.TOUCH_END,this,this.banner_touch_end),this.addEvent(this.game_btn,egret.TouchEvent.TOUCH_TAP,this,this.gotoGame),this.addEvent(this.purse_btn,egret.TouchEvent.TOUCH_TAP,this,this.showPurse),this.addEvent(this.card_btn,egret.TouchEvent.TOUCH_TAP,this,this.showCard),this.addEvent(this.news_list,eui.ItemTapEvent.ITEM_TAP,this,this.showNewsContant),this.addEvent(this.news_list0,eui.ItemTapEvent.ITEM_TAP,this,this.showNewsContant),this.addEvent(this.invite_code_btn,egret.TouchEvent.TOUCH_TAP,this,this.copyCode),this.addEvent(this.setting_btn,egret.TouchEvent.TOUCH_TAP,this,this.showSettingPage),this.addEvent(cor.EventManage.instance(),UpdataUserInfo,this,this.updata_info)},n.prototype.getNews=function(){var t=this;cor.Socket.getIntance().sendmsg("GET_POST_LIST",{page:1,page_size:10,is_index:1},function(e){t.news_list.dataProvider=new eui.ArrayCollection(e)},this)},n.prototype.showNewsContant=function(e){cor.Socket.getIntance().sendmsg("GET_POST_INFO",{id:e.item.id},function(e){cor.MainScene.instance().addChild(new t.NewsContant(e))},this)},n.prototype.getBanners=function(){var t=this;cor.Socket.getIntance().sendmsg("GET_AD_LIST_BY_POSITION_ID",{page_size:3,position_id:1},function(e){for(var n=0;n<e.length;n++){var i=e[n];t.banner_urls.push(i.url);var r=new eui.Image(i.content);r.width=600,r.height=360,r.anchorOffsetX=315,r.anchorOffsetY=180,r.x=375+540*n,r.y=180,n>0&&(r.scaleX=r.scaleY=.7),t.banner_group.addChild(r);
var o=new eui.Image("Banner_Switch_png");n>0&&(o.source="Line_Main01_png"),t.bannerIndex_group.addChild(o)}setInterval(function(){t.banner_move(1)},3e3)},this)},n.prototype.banner_touch_begin=function(t){this.banner_touch_bx=t.stageX},n.prototype.banner_touch_end=function(t){var e=t.stageX-this.banner_touch_bx;e>100?this.banner_move(0):-100>e?this.banner_move(1):this.banner_move(2)},n.prototype.banner_move=function(t){var e=this.banner_group.getChildAt(this.banner_currentIndex),n=this.bannerIndex_group.getChildAt(this.banner_currentIndex);switch(t){case 0:this.banner_currentIndex>0?this.banner_currentIndex--:this.banner_currentIndex=this.banner_group.numChildren-1;var i=this.banner_group.getChildAt(this.banner_currentIndex),r=this.bannerIndex_group.getChildAt(this.banner_currentIndex);egret.Tween.get(this.banner_group).to({x:540*-this.banner_currentIndex},300),egret.Tween.get(e).to({scaleX:.7,scaleY:.7},300),egret.Tween.get(i).to({scaleX:1,scaleY:1},300),n.source="Line_Main01_png",r.source="Banner_Switch_png";break;case 1:this.banner_currentIndex<this.banner_group.numChildren-1?this.banner_currentIndex++:this.banner_currentIndex=0;var r=this.bannerIndex_group.getChildAt(this.banner_currentIndex),i=this.banner_group.getChildAt(this.banner_currentIndex);egret.Tween.get(this.banner_group).to({x:540*-this.banner_currentIndex},300),egret.Tween.get(e).to({scaleX:.7,scaleY:.7},300),egret.Tween.get(i).to({scaleX:1,scaleY:1},300),n.source="Line_Main01_png",r.source="Banner_Switch_png";break;case 2:egret.ExternalInterface.call("sendToNative","webview$"+this.banner_urls[this.banner_currentIndex])}},n.prototype.changeBtnState=function(t){return this.currentNav==t?!1:(this.currentNav.currentState="up",t.currentState="down",this.currentNav=t,cor.MainScene.instance().clearPage(),!0)},n.prototype.showHome=function(){this.changeBtnState(this.home_btn)&&(this.cureentPage.visible=!1,this.home_group.visible=!0,this.cureentPage=this.home_group)},n.prototype.showNews=function(){var t=this;cor.Socket.getIntance().sendmsg("GET_POST_LIST",{page:1,page_size:100,is_index:0},function(e){Log(e),t.news_list0.dataProvider=new eui.ArrayCollection(e),t.changeBtnState(t.news_btn)&&(t.cureentPage.visible=!1,t.news_group.visible=!0,t.cureentPage=t.news_group)},this)},n.prototype.showExchange=function(){t.TipsSkin.instance().show("暂未开放")},n.prototype.showPersonal=function(){var t=this;cor.Socket.getIntance().sendmsg("GET_ME",{},function(e){Log(e),t.changeBtnState(t.personal_btn)&&(t.cureentPage.visible=!1,t.personal_group.visible=!0,t.cureentPage=t.personal_group,t.nickName.text=e.nickname,t.my_invite_code.text=e.invitation_code,t.telNum.text=GameData.UserPhone,t.headImg.source=e.picture,GameData.UserInfo=e)},this)},n.prototype.updata_info=function(){this.headImg.source=GameData.UserInfo.picture,this.nickName.text=GameData.UserInfo.nickname},n.prototype.gotoGame=function(){var e=this;cor.Socket.getIntance().sendmsg("GET_USER_BASE_INFO",{},function(n){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return Log(n),egret.MainContext.instance.stage.setContentSize(1334,750),egret.MainContext.instance.stage.orientation=egret.OrientationMode.LANDSCAPE,egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.FIXED_HEIGHT,GameData.GameWidth=egret.MainContext.instance.stage.stageWidth,GameData.GameHeigth=egret.MainContext.instance.stage.stageHeight,GameData.BGame=!0,GameData.UserInfo=n,e=new t.LoadingView,this.addChild(e),[4,RES.loadGroup("gameres",0,e)];case 1:return i.sent(),e.dispose(),cor.MainScene.instance().addChild(new t.GameScene),[2]}})})},this)},n.prototype.showPurse=function(){var e=this;cor.Socket.getIntance().sendmsg("WALLET_LIST",{},function(n){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return Log(n),cor.MainScene.instance().addChild(new t.PursePage(n)),[2]})})},this)},n.prototype.showCard=function(){t.TipsSkin.instance().show("暂未开放")},n.prototype.copyCode=function(){egret.ExternalInterface.call("sendToNative","copyStr$"+GameData.UserInfo.invitation_code)},n.prototype.showSettingPage=function(){cor.MainScene.instance().addChild(new t.SettingPage)},n}(cor.BaseScene);t.HomePage=e,__reflect(e.prototype,"Game.HomePage")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="InfoSettingPage",e.init(),e.initEnent(),e}return __extends(e,t),e.prototype.init=function(){this.headImg.mask=this.headMask,this.headImg.source=GameData.UserInfo.picture,this.nickname.text=GameData.UserInfo.nickname,this.sex.text=GameData.UserInfo.sex==SEX.Man?"男":"女",this.birth.text=GameData.UserInfo.birthday,this.reset_head_btn.visible=!1,this._radioGroup=new eui.RadioButtonGroup,this.rdb_man.group=this._radioGroup,this.rdb_woman.group=this._radioGroup},e.prototype.initEnent=function(){var t=this;this.addEvent(this.back_btn,egret.TouchEvent.TOUCH_TAP,this,this.dispose),this.addEvent(this.reset_head_btn,egret.TouchEvent.TOUCH_TAP,this,this.selectImg),this.addEvent(this.reset_nickname_btn,egret.TouchEvent.TOUCH_TAP,this,this.reset_nickname),this.addEvent(this.nickname_cancel_btn,egret.TouchEvent.TOUCH_TAP,this,function(){t.change_nickname_group.visible=!1}),this.addEvent(this.changeNickname_btn,egret.TouchEvent.TOUCH_TAP,this,this.changeNickname),this.addEvent(this.reset_sex_btn,egret.TouchEvent.TOUCH_TAP,this,this.reset_sex),this.addEvent(this.changeSex_cancel_btn,egret.TouchEvent.TOUCH_TAP,this,function(){t.change_sex_group.visible=!1}),this.addEvent(this.changeSex_btn,egret.TouchEvent.TOUCH_TAP,this,this.changeSex),this.addEvent(this._radioGroup,eui.UIEvent.CHANGE,this,function(e){var n=e.target;t._sex_select=n.selectedValue}),this.addEvent(this.reset_birth_btn,egret.TouchEvent.TOUCH_TAP,this,this.reset_birth),this.addEvent(this.changeBirth_cancel_btn,egret.TouchEvent.TOUCH_TAP,this,function(){t.change_birth_group.visible=!1}),this.addEvent(this.changeBirth_btn,egret.TouchEvent.TOUCH_TAP,this,this.changeBirth),this.addEvent(this.year_select,egret.TouchEvent.TOUCH_TAP,this,this.showSelect,[0]),this.addEvent(this.month_select,egret.TouchEvent.TOUCH_TAP,this,this.showSelect,[1]),this.addEvent(this.day_select,egret.TouchEvent.TOUCH_TAP,this,this.showSelect,[2]),this.addEvent(this.birth_list,eui.ItemTapEvent.ITEM_TAP,this,this.itemSelect),this.addEvent(cor.EventManage.instance(),UpdataUserInfo,this,this.updata_head),egret.ExternalInterface.addCallback("selectImg_head_result",function(e){cor.Socket.getIntance().sendmsg("UPDATE_USER_PROFILE",{picture:"data:image/png;base64,"+e},function(t){Log(t),GameData.UserInfo=t,cor.EventManage.instance().sendEvent(UpdataUserInfo)},t)})},e.prototype.selectImg=function(){egret.ExternalInterface.call("sendToNative","selectImg$0")},e.prototype.updata_head=function(){this.headImg.source=GameData.UserInfo.picture},e.prototype.reset_nickname=function(){this.change_nickname_group.visible=!0,this.nickname_input.text="",this.nickname_input.prompt=GameData.UserInfo.nickname},e.prototype.changeNickname=function(){var t=this;cor.Socket.getIntance().sendmsg("UPDATE_USER_PROFILE",{nickname:this.nickname_input.text},function(e){Log(e),GameData.UserInfo=e,cor.EventManage.instance().sendEvent(UpdataUserInfo),t.nickname.text=GameData.UserInfo.nickname,t.change_nickname_group.visible=!1},this)},e.prototype.reset_sex=function(){this.change_sex_group.visible=!0,GameData.UserInfo.sex==SEX.Man?this.rdb_man.selected=!0:this.rdb_woman.selected=!0},e.prototype.changeSex=function(){var t=this;cor.Socket.getIntance().sendmsg("UPDATE_USER_PROFILE",{sex:this._sex_select},function(e){Log(e),GameData.UserInfo=e,t.sex.text=GameData.UserInfo.sex==SEX.Man?"男":"女",t.change_sex_group.visible=!1},this)},e.prototype.reset_birth=function(){this.change_birth_group.visible=!0,this.birth_list.dataProvider=new eui.ArrayCollection,this.birth_scroller.visible=!1;var t=GameData.UserInfo.birthday.split("-");this.year_select.text=t[0],this.month_select.text=t[1],this.day_select.text=t[2]},e.prototype.showSelect=function(t){var e=176+155*t;if(e==this.birth_scroller.x&&this.birth_scroller.visible)return void(this.birth_scroller.visible=!1);this.birth_scroller.visible=!0,this.birth_scroller.x=e,this.birth_scroller.viewport.scrollV=0,this.birth_scroller.stopAnimation();var n=0,i=2e3;switch(t){case 0:n=1920,i=2001;break;case 1:n=1,i=12;break;case 2:n=1,i=31}for(var r=[],o=n;i>o;o++){var s=10>o?"0"+o:""+o;r.push({num:s,type:t})}this.birth_list.dataProvider=new eui.ArrayCollection(r)},e.prototype.itemSelect=function(t){var e=t.item;switch(e.type){case 0:this.year_select.text=e.num;break;case 1:this.month_select.text=e.num;break;case 2:this.day_select.text=e.num}this.birth_list.dataProvider=new eui.ArrayCollection,this.birth_scroller.visible=!1},e.prototype.changeBirth=function(){var t=this,e=this.year_select.text+"-"+this.month_select.text+"-"+this.day_select.text;cor.Socket.getIntance().sendmsg("UPDATE_USER_PROFILE",{birthday:e},function(e){Log(e),GameData.UserInfo=e,t.birth.text=GameData.UserInfo.birthday,t.change_birth_group.visible=!1},this)},e}(cor.BaseScene);t.InfoSettingPage=e,__reflect(e.prototype,"Game.InfoSettingPage")}(Game||(Game={}));var Game;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="LoginSkin",t.regist_state=0,t.isRestPsw=!1,t.code_key="",t.regist_code_Int=-1,t.reset_code_Int=-1,t.regist_code_time=0,t.reset_code_time=0,t.init(),t.initEnent(),t.showPhoneLgRe(),t}return __extends(n,e),n.prototype.init=function(){readLocalData(UserPhone)&&(this.phone_input.text=readLocalData(UserPhone))},n.prototype.initEnent=function(){this.addEvent(this.wx_lg_btn,egret.TouchEvent.TOUCH_TAP,this,this.wxLogin),this.addEvent(this.lg_btn,egret.TouchEvent.TOUCH_TAP,this,this.phoneLogin),this.addEvent(this.nextstep_btn,egret.TouchEvent.TOUCH_TAP,this,this.nextstep),this.addEvent(this.sure_login_btn,egret.TouchEvent.TOUCH_TAP,this,this.sendLogin),this.addEvent(this.back_btn,egret.TouchEvent.TOUCH_TAP,this,this.backHome),this.addEvent(this.lost_password_btn,egret.TouchEvent.TOUCH_TAP,this,this.RestPassword),this.addEvent(this.code_btn,egret.TouchEvent.TOUCH_TAP,this,this.sendCode),this.addEvent(this.reset_code_btn,egret.TouchEvent.TOUCH_TAP,this,this.sendCode),this.addEvent(this.regist_btn,egret.TouchEvent.TOUCH_TAP,this,this.sendRegist)},n.prototype.backHome=function(){switch(this.regist_state){case 1:case 2:this.regist_state--;break;case 3:this.regist_state=1}this.showPhoneLgRe()},n.prototype.wxLogin=function(){var e=this;cor.Socket.getIntance().sendmsg("LOGIN",{mobile:"15017557355",password:"123456"},function(n){t.TipsSkin.instance().show("登录成功"),e.dispose(),cor.MainScene.instance().addChild(new t.HomePage)},this)},n.prototype.phoneLogin=function(){this.regist_state=1,this.showPhoneLgRe()},n.prototype.nextstep=function(){var e=this;return checkPhone(this.phone_input.text)?void cor.Socket.getIntance().sendmsg("CHECK_MOBILE",{mobile:this.phone_input.text},function(t){t?(e.regist_state=2,e.showPhoneLgRe()):(e.regist_state=3,e.showPhoneLgRe())},this,!1):void t.TipsSkin.instance().show("手机格式不正确")},n.prototype.phoneRegist=function(){this.regist_state=2,this.showPhoneLgRe(),this.isRestPsw=!1,this.regist_btn.wz.text="注册",this.reset_code_btn.visible=!1,this.code_btn.visible=!0,this.invite_group.visible=!0},n.prototype.RestPassword=function(){this.regist_state=3,this.showPhoneLgRe(),this.isRestPsw=!0,this.regist_btn.wz.text="重置密码",this.reset_code_btn.visible=!0,this.code_btn.visible=!1,this.invite_group.visible=!1},n.prototype.sendCode=function(){var t=this,e="register";this.isRestPsw&&(e="force_password"),cor.Socket.getIntance().sendmsg("SEND_SMS_CODE",{mobile:this.phone_input.text,type:e},function(e){if(t.code_key=e.key,t.isRestPsw){if(t.reset_code_time>0)return;t.reset_code_time=60,t.reset_code_btn.wz.text=t.reset_code_time+"秒后重新获取",t.reset_code_btn.wz.size=18,t.reset_code_Int=setInterval(function(){t.reset_code_time--,t.reset_code_btn.wz.text=t.reset_code_time+"秒后重新获取",0==t.reset_code_time&&(clearInterval(t.reset_code_Int),t.reset_code_btn.wz.text="获取验证码",t.reset_code_btn.wz.size=18)},1e3)}else{if(t.regist_code_time>0)return;t.regist_code_time=60,t.code_btn.wz.text=t.regist_code_time+"秒后重新获取",t.code_btn.wz.size=18,t.regist_code_Int=setInterval(function(){t.regist_code_time--,t.code_btn.wz.text=t.regist_code_time+"秒后重新获取",0==t.regist_code_time&&(clearInterval(t.regist_code_Int),t.code_btn.wz.text="获取验证码",t.code_btn.wz.size=20)},1e3)}},this)},n.prototype.sendRegist=function(){var e=this;return checkPassword(this.regist_psw_input.text)?void(this.isRestPsw?cor.Socket.getIntance().sendmsg("FORGET_PASSWORD",{mobile:this.phone_input.text,code:this.code_input.text,key:this.code_key,password:this.regist_psw_input.text},function(n){t.TipsSkin.instance().show("\b重置密码成功"),e.regist_state=2,e.showPhoneLgRe()},this):cor.Socket.getIntance().sendmsg("REGISTER",{mobile:this.phone_input.text,code:this.code_input.text,key:this.code_key,invitation_code:this.invite_input.text,password:this.regist_psw_input.text},function(n){t.TipsSkin.instance().show("注册成功"),e.paswd_input.text=e.regist_psw_input.text,e.sendLogin()},this)):void t.TipsSkin.instance().show("密码格式不正确")},n.prototype.sendLogin=function(){var e=this;cor.Socket.getIntance().sendmsg("LOGIN",{mobile:this.phone_input.text,password:this.paswd_input.text},function(n){t.TipsSkin.instance().show("登录成功"),GameData.UserPhone=e.phone_input.text,GameData.UserPassword=e.paswd_input.text,saveLocalData(UserPhone,GameData.UserPhone),e.dispose(),cor.MainScene.instance().addChild(new t.HomePage)},this)},n.prototype.showPhoneLgRe=function(){switch(0==this.regist_state?(this.login_group.visible=!1,this.lg_group.visible=!0):(this.login_group.visible=!0,this.lg_group.visible=!1),this.regist_state){case 1:this.phone_group.visible=!0,this.password_group.visible=this.regist_group.visible=!1;break;case 2:this.password_group.visible=!0,this.phone_group.visible=this.regist_group.visible=!1,this.paswd_input.text="";break;case 3:this.regist_group.visible=!0,this.phone_group.visible=this.password_group.visible=!1,this.regist_psw_input.text="",this.code_input.text=""}},n}(cor.BaseScene);t.LoginSkin=e,__reflect(e.prototype,"Game.LoginSkin")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(e){var n=t.call(this)||this;return n.skinName="NewsContant",n.init(e),n.initEnent(),n}return __extends(e,t),e.prototype.init=function(t){this.contentScroller.height=this.height-this.contentScroller.y-10,Log(t),this.title.text=t.title,this.time.text=t.publish_at,this.img.source=t.thumb,this.contants.text=t.content},e.prototype.initEnent=function(){this.addEvent(this.back,egret.TouchEvent.TOUCH_TAP,this,this.dispose)},e}(cor.BaseScene);t.NewsContant=e,__reflect(e.prototype,"Game.NewsContant")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="NewsItem",e.init(),e.initEnent(),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.initEnent=function(){this.once(eui.UIEvent.COMPLETE,this.onComplete,this),this.addEventListener(eui.UIEvent.REMOVED_FROM_STAGE,this.dispose,this)},e.prototype.onComplete=function(){},e.prototype.dataChanged=function(){},e.prototype.dispose=function(){this.removeChildren(),this.removeEventListener(eui.UIEvent.REMOVED_FROM_STAGE,this.dispose,this)},e}(eui.ItemRenderer);t.NewsItem=e,__reflect(e.prototype,"Game.NewsItem")}(Game||(Game={}));var Game;!function(t){var e=function(e){function n(t){var n=e.call(this)||this;return n.skinName="PursePage",n.init(t),n.initEvent(),n}return __extends(n,e),n.prototype.init=function(t){this._purseInfo=t;for(var e in t)"GST"==t[e].coin_name?this.gst_info_btn.num.text=toThousands(Math.round(t[e].available_balance)):this.usdt_info_btn.num.text=toThousands(Math.round(t[e].available_balance))},n.prototype.initEvent=function(){this.addEvent(this.close_btn,egret.TouchEvent.TOUCH_TAP,this,this.dispose),this.addEvent(this.scan_btn,egret.TouchEvent.TOUCH_TAP,this,this.scan),this.addEvent(this.gst_info_btn,egret.TouchEvent.TOUCH_TAP,this,this.gst_info),this.addEvent(this.usdt_info_btn,egret.TouchEvent.TOUCH_TAP,this,this.usdt_info),this.addEvent(this.income_btn,egret.TouchEvent.TOUCH_TAP,this,this.income),this.addEvent(this.output_btn,egret.TouchEvent.TOUCH_TAP,this,this.output),egret.ExternalInterface.addCallback("scanResult",function(t){})},n.prototype.scan=function(){egret.ExternalInterface.call("scanQRCode","")},n.prototype.gst_info=function(){var e=this;cor.Socket.getIntance().sendmsg("TRANSACTION_RECORDS",{coin_name:"GST",page:1,page_size:100},function(n){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return Log(n),cor.MainScene.instance().addChild(new t.RecodePage(n,"GST")),[2]})})},this)},n.prototype.usdt_info=function(){var e=this;cor.Socket.getIntance().sendmsg("TRANSACTION_RECORDS",{coin_name:"USDT",page:1,page_size:100},function(n){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return Log(n),cor.MainScene.instance().addChild(new t.RecodePage(n,"USDT")),[2]})})},this)},n.prototype.income=function(){},n.prototype.output=function(){},n}(cor.BaseScene);t.PursePage=e,__reflect(e.prototype,"Game.PursePage")}(Game||(Game={}));var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?i(r):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Game;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="ResetPassword",t.init(),t.initEnent(),t}return __extends(n,e),n.prototype.init=function(){},n.prototype.initEnent=function(){this.addEvent(this.changepassword_cancel_btn,egret.TouchEvent.TOUCH_TAP,this,this.dispose),this.addEvent(this.changePassword_btn,egret.TouchEvent.TOUCH_TAP,this,this.changePassword)},n.prototype.changePassword=function(){var e=this;return this.old_password_input.text!=GameData.UserPassword?void t.TipsSkin.instance().show("原密码不正确"):""==this.new_password_input.text?void t.TipsSkin.instance().show("密码不能为空"):checkPassword(this.new_password_input.text)?this.new_password_input.text==this.old_password_input.text?void t.TipsSkin.instance().show("新旧密码相同"):void cor.Socket.getIntance().sendmsg("UPDATE_USER_PROFILE",{password:this.new_password_input.text},function(n){Log(n),GameData.UserPassword=e.new_password_input.text,t.TipsSkin.instance().show("新密码设置成功"),e.dispose()},this):void t.TipsSkin.instance().show("密码格式不正确")},n}(cor.BaseScene);t.ResetPassword=e,__reflect(e.prototype,"Game.ResetPassword")}(Game||(Game={}));var Game;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="SettingPage",t.init(),t.initEnent(),t}return __extends(n,e),n.prototype.init=function(){""===GameData.UserPassword&&(this.reset_password_btn.visible=!1)},n.prototype.initEnent=function(){this.addEvent(this.back_btn,egret.TouchEvent.TOUCH_TAP,this,this.dispose),this.addEvent(this.info_setting_btn,egret.TouchEvent.TOUCH_TAP,this,this.showInfoSetting),this.addEvent(this.exit_login_btn,egret.TouchEvent.TOUCH_TAP,this,this.exit_login),this.addEvent(this.reset_password_btn,egret.TouchEvent.TOUCH_TAP,this,this.reset_password)},n.prototype.showInfoSetting=function(){cor.MainScene.instance().addChild(new t.InfoSettingPage)},n.prototype.exit_login=function(){cor.MainScene.instance().clearScene(),cor.MainScene.instance().addChild(new t.LoginSkin),cor.Socket.getIntance().changeUrl()},n.prototype.reset_password=function(){cor.MainScene.instance().addChild(new t.ResetPassword)},n}(cor.BaseScene);t.SettingPage=e,__reflect(e.prototype,"Game.SettingPage")}(Game||(Game={}));var Game;!function(t){var e=function(e){function n(t){var n=e.call(this)||this;return n.skinName="ExchangeCenter",n.init(t),n.initEvent(),n}return __extends(n,e),n.prototype.init=function(e){var n=this;this.exchange_num.restrict="0-9",this._exchangedata=e,this.head_group.addChild(new t.headComment(this,"矿\b石交易所","ORE EXCHANGE")),this.addDB(this.role_group,"Jiaoyisuo");for(var i=[],r=0;7>r;r++)i.push(e[r]);i.sort(compare("value",!1)),Log(i);for(var o=0,r=0;7>r;r++){var s=this.date_group.getChildAt(r);s.text=e[r].date.substr(5);var a=this.rate_group.getChildAt(r);a.text=e[r].value+"";var h=this.sharp_group.getChildAt(r);h.scaleY=0;var c=e[r].value/i[0].value,u=246*(1-c);if(r>0&&6>r){var d=this.point_group.getChildAt(r-1);d.y=u}if(a.y=u,egret.Tween.get(h).wait(200).to({scaleY:c},500,egret.Ease.backOut),r>0){var g=this.sharp_group.getChildAt(r-1),_=egret.Point.distance(new egret.Point(h.x,u),new egret.Point(g.x,o)),p=this.line_group.getChildAt(r-1);p.y=o+10,p.x=g.x+5,p.width=_;var l=Math.round(180*Math.atan((o-u)/(g.x-h.x))/Math.PI);p.rotation=l}o=u}cor.Socket.getIntance().sendmsg("GET_EXCHANGE_CONFIG",{},function(t){Log(t),n._today_rate=t,n.rateTx.text=n.rateTx.text.replace("@num",t)},this)},n.prototype.initEvent=function(){var t=this;this.addEvent(this.recode_btn,egret.TouchEvent.TOUCH_TAP,this,this.showRecode),this.addEvent(this.exchange_btn,egret.TouchEvent.TOUCH_TAP,this,this.exchange),this.addEvent(this.exchange_num,eui.UIEvent.CHANGE,this,this.showExchangeRate),this.addEvent(this.close_btn,egret.TouchEvent.TOUCH_TAP,this,function(){t.rdcode_group.visible=!1})},n.prototype.showExchangeRate=function(t){this.exchangeRate.text="GST="+Number(t.target.text)*this._today_rate+"矿石"},n.prototype.exchange=function(){var e=this;cor.Socket.getIntance().sendmsg("EXCHANGE_GST",{number:Number(this.exchange_num.text)},function(n){Log(n),GameData.UserInfo.gts_number+=Number(e.exchange_num.text),GameData.UserInfo.mineral-=Number(e.exchange_num.text)*e._today_rate,cor.EventManage.instance().sendEvent(UpdataGameInfo),t.TipsSkin.instance().show("兑换成功")},this)},n.prototype.showRecode=function(){var t=this;this.rdcode_group.visible=!0,cor.Socket.getIntance().sendmsg("EXCHANGE_RECORD",{},function(e){Log(e);for(var n in e)e[n].use_mine="使用"+e[n].mineral_number+"矿石",e[n].exchange_gst="兑换"+e[n].gst_number+"GST";t.recode_list.dataProvider=new eui.ArrayCollection(e)},this)},n}(cor.BaseScene);t.ExchangeCenter=e,__reflect(e.prototype,"Game.ExchangeCenter")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(e){var n=t.call(this)||this;return n.skinName="GameFriend",n.init(e),n.initEvent(),n}return __extends(e,t),e.prototype.init=function(t){var e=t;for(var n in e)e[n].curLevel=t[n].identity==IDENTITY.Miner?t[n].grade:"v"+t[n].current_hold_area_grade,e[n].isower=t[n].identity==IDENTITY.Owner;this.friendList.dataProvider=new eui.ArrayCollection(e)},e.prototype.initEvent=function(){this.addEvent(this.back_btn,egret.TouchEvent.TOUCH_TAP,this,this.dispose)},e}(cor.BaseScene);t.GameFriend=e,__reflect(e.prototype,"Game.GameFriend")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="GameLoading",e.init(),e.initEnent(),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.initEnent=function(){},e}(cor.BaseScene);t.GameLoading=e,__reflect(e.prototype,"Game.GameLoading")}(Game||(Game={}));var Game;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="GameScene",t._dig_time_int=-1,t._notice_timeTag=null,t._notice_move=!1,t.init(),t.initEnent(),t.getNotice(),t}return __extends(n,e),n.prototype.init=function(){GameData.UserInfo.identity==IDENTITY.Miner?(this.mine_btn.touchEnabled=!1,this.owner_icon.visible=!1,this.level.text=GameData.UserInfo.grade,this.bg.source="Bg_MiningArea_Lv1_png",this.addDB(this.role_group,"Kuangquguangli")):(this.mine_group.visible=!1,this.level.text="v"+GameData.UserInfo.current_hold_area_grade,this.bg.source="Bg_MiningArea_Lv"+GameData.UserInfo.current_hold_area_grade+"_png",this.addDB(this.role_group,"Lv"+GameData.UserInfo.current_hold_area_grade)),this.headImg.source=GameData.UserInfo.picture,this.nickname.text=GameData.UserInfo.nickname,this.gst_num.text=GameData.UserInfo.gts_number+"",this.mine_num.text=GameData.UserInfo.mineral+"",this.setExpbar();var t=[.3,.3,0,0,0,.3,.3,0,0,0,.3,.3,0,0,0,0,0,0,1,0],e=new egret.ColorMatrixFilter(t);this.share_btn.filters=[e],GameData.UserInfo.identity==IDENTITY.Miner&&(this.tools_store_btn.filters=[e]),"string"==typeof GameData.UserInfo.dig_time&&(GameData.UserInfo.dig_time=TimeTonumber(GameData.UserInfo.dig_time)),GameData.UserInfo.dig_time>0&&this.startDigMine()},n.prototype.initEnent=function(){var t=this;this.addEvent(this.exitbtn,egret.TouchEvent.TOUCH_TAP,this,this.exitGame),this.addEvent(this.manager_btn,egret.TouchEvent.TOUCH_TAP,this,this.showManager),this.addEvent(this.mine_btn,egret.TouchEvent.TOUCH_TAP,this,this.showMine),this.addEvent(this.exchange_center_btn,egret.TouchEvent.TOUCH_TAP,this,this.showExchange_center),this.addEvent(this.server_center_btn,egret.TouchEvent.TOUCH_TAP,this,this.showServer_center),this.addEvent(this.tools_store_btn,egret.TouchEvent.TOUCH_TAP,this,this.showToolsStore),this.addEvent(this.warehouse_btn,egret.TouchEvent.TOUCH_TAP,this,this.showWarehouse),this.addEvent(this.email_btn,egret.TouchEvent.TOUCH_TAP,this,this.tapNotice),this.addEvent(this.setting_btn,egret.TouchEvent.TOUCH_TAP,this,this.showSetting),this.addEvent(this.share_btn,egret.TouchEvent.TOUCH_TAP,this,this.showShare),this.addEvent(this.friend_btn,egret.TouchEvent.TOUCH_TAP,this,this.showFriend),this.addEvent(this.headImg,egret.TouchEvent.TOUCH_TAP,this,this.showSetting),this.addEvent(cor.EventManage.instance(),ChangeIdentity,this,this.changeIdentity),this.addEvent(cor.EventManage.instance(),ExitGame,this,this.exitGame),this.addEvent(cor.EventManage.instance(),UpdataUserInfo,this,this.updata_info),this.addEvent(cor.EventManage.instance(),UpdataGameInfo,this,this.updata_gameinfo),this.addEvent(cor.EventManage.instance(),NEW_NOTICE,this,this.noticTip),this.addEvent(cor.EventManage.instance(),StartDigMine,this,this.startDigMine),egret.ExternalInterface.addCallback("creatQRCode",function(e){console.log(e);var n=new eui.Image;n.source="data:image/png;base64,"+e,t.addChild(n)})},n.prototype.setExpbar=function(){this.expbar.width=GameData.UserInfo.experience/GameData.UserInfo.current_grade_max_experience*248},n.prototype.getNotice=function(){var t=this;cor.Socket.getIntance().sendmsg("GET_NOTICE",{},function(e){Log(e),t.notice_info.text="暂无公告",t.showNotice(),null!=e&&(t.notice_info.text=e.content),t._notice_timeTag=setTimeout(function(){t._notice_timeTag=null,t.hideNotice()},2e3)},this)},n.prototype.showNotice=function(){var t=this;this._notice_move=!0,egret.Tween.get(this.notice_group).to({x:0},300).call(function(){t._notice_move=!1})},n.prototype.hideNotice=function(){var t=this;this._notice_move=!0,egret.Tween.get(this.notice_group).to({x:-311},300).call(function(){t._notice_move=!1})},n.prototype.tapNotice=function(){this._notice_move||(0==this.notice_group.x?(null!=this._notice_timeTag&&(clearTimeout(this._notice_timeTag),this._notice_timeTag=null),this.hideNotice()):(this.notic_tip_img.visible&&(this.notic_tip_img.visible=!1),this.showNotice()))},n.prototype.noticTip=function(t){this.notic_tip_img.visible=!0,this.notice_info.text=t.data,egret.Tween.get(this.notic_tip_img).wait(400).to({alpha:0}).wait(100).to({alpha:1}).wait(400).to({alpha:0}).wait(100).to({alpha:1})},n.prototype.showManager=function(){cor.Socket.getIntance().sendmsg("HOLD_AREA_LIST",{},function(e){Log(e),cor.MainScene.instance().addChild(new t.MineManager(e))},this)},n.prototype.showMine=function(){cor.Socket.getIntance().sendmsg("GET_USER_HOLD_AREA_CONFIG",{},function(e){Log(e),cor.MainScene.instance().addChild(new t.MineArea(e))},this)},n.prototype.showToolsStore=function(){return GameData.UserInfo.identity==IDENTITY.Miner?void t.TipsSkin.instance().show("暂时不对矿工开放"):void cor.Socket.getIntance().sendmsg("STORE_GOOD_LIST",{},function(e){Log(e),cor.MainScene.instance().addChild(new t.ToolsStore(e))},this)},n.prototype.showWarehouse=function(){cor.Socket.getIntance().sendmsg("USER_GOOD_LIST",{},function(e){Log(e),cor.MainScene.instance().addChild(new t.Warehouse(e))},this)},n.prototype.showServer_center=function(){cor.Socket.getIntance().sendmsg("USER_HOLD_AREA_LIST",{},function(e){Log(e),cor.MainScene.instance().addChild(new t.MinerServerCenter(e))},this)},n.prototype.showExchange_center=function(){cor.Socket.getIntance().sendmsg("EVERY_CONVERT_RECORD",{},function(e){Log(e),cor.MainScene.instance().addChild(new t.ExchangeCenter(e))},this)},n.prototype.showSetting=function(){this.addChild(new t.GameSetting)},n.prototype.showShare=function(){this.addChild(new t.GameShare)},n.prototype.showFriend=function(){var e=this;cor.Socket.getIntance().sendmsg("FRIEND_LIST",{},function(n){Log(n),e.addChild(new t.GameFriend(n))},this)},n.prototype.exitGame=function(){egret.MainContext.instance.stage.setContentSize(750,1334),egret.MainContext.instance.stage.orientation=egret.OrientationMode.PORTRAIT,egret.MainContext.instance.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,GameData.GameWidth=egret.MainContext.instance.stage.stageWidth,GameData.GameHeigth=egret.MainContext.instance.stage.stageHeight,-1!=this._dig_time_int&&clearInterval(this._dig_time_int),this.dispose()},n.prototype.changeIdentity=function(t){var e=this;if(cor.Socket.getIntance().sendmsg("GET_USER_BASE_INFO",{},function(t){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return Log(t),GameData.UserInfo=t,[2]})})},this),GameData.UserInfo.identity==IDENTITY.Owner)this.mine_btn.touchEnabled=!0,this.mine_group.visible=!1,this.owner_icon.visible=!0,this.level.text="v"+GameData.UserInfo.current_hold_area_grade,this.tools_store_btn.filters=[],this.removeDB(),this.addDB(this.role_group,"Lv"+GameData.UserInfo.current_hold_area_grade);else{this.mine_btn.touchEnabled=!1,this.mine_group.visible=!0,this.owner_icon.visible=!1,this.level.text=GameData.UserInfo.grade,this.removeDB(),this.addDB(this.role_group,"Kuangquguangli");var n=[.3,.3,0,0,0,.3,.3,0,0,0,.3,.3,0,0,0,0,0,0,1,0],i=new egret.ColorMatrixFilter(n);this.tools_store_btn.filters=[i]}},n.prototype.updata_info=function(){this.nickname.text=GameData.UserInfo.nickname},n.prototype.updata_gameinfo=function(){this.gst_num.text=GameData.UserInfo.gts_number+"",this.mine_num.text=GameData.UserInfo.mineral+""},n.prototype.startDigMine=function(){var t=this;this._dig_time_int=setInterval(function(){GameData.UserInfo.dig_time--,GameData.UserInfo.dig_time<=0&&(GameData.UserInfo.dig_time=0,clearInterval(t._dig_time_int),t._dig_time_int=-1),cor.EventManage.instance().sendEvent(DigMineTime)},1e3)},n}(cor.BaseScene);t.GameScene=e,__reflect(e.prototype,"Game.GameScene")}(Game||(Game={}));var Game;!function(t){var e=function(e){function n(){var t=e.call(this)||this;return t.skinName="GameSetting",t.init(),t.initEvent(),t}return __extends(n,e),n.prototype.init=function(){this.nickname_edt.text=GameData.UserInfo.nickname,readLocalData(GameMusic)&&"1"==readLocalData(GameMusic)?this.music_switch.selected=!0:this.music_switch.selected=!1},n.prototype.initEvent=function(){this.addEvent(this.back_btn,egret.TouchEvent.TOUCH_TAP,this,this.dispose),this.addEvent(this.return_game_btn,egret.TouchEvent.TOUCH_TAP,this,this.dispose),this.addEvent(this.exit_game_btn,egret.TouchEvent.TOUCH_TAP,this,this.exitGame),this.addEvent(this.change_nickname_btn,egret.TouchEvent.TOUCH_TAP,this,this.change_nickname),this.addEvent(this.music_switch,eui.UIEvent.CHANGE,this,this.set_music)},n.prototype.exitGame=function(){this.dispose(),cor.EventManage.instance().sendEvent(ExitGame)},n.prototype.change_nickname=function(){var e=this;cor.Socket.getIntance().sendmsg("UPDATE_USER_PROFILE",{nickname:this.nickname_edt.text},function(n){Log(n),GameData.UserInfo.nickname=e.nickname_edt.text,cor.EventManage.instance().sendEvent(UpdataUserInfo),t.TipsSkin.instance().show("昵称修改成功")},this)},n.prototype.set_music=function(t){Log(t.target.selected);var e=t.target.selected?"1":"0";saveLocalData(GameMusic,e)
},n}(cor.BaseScene);t.GameSetting=e,__reflect(e.prototype,"Game.GameSetting")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="GameShare",e.init(),e.initEvent(),e}return __extends(e,t),e.prototype.init=function(){},e.prototype.initEvent=function(){this.addEvent(this.back_btn,egret.TouchEvent.TOUCH_TAP,this,this.dispose),this.addEvent(this.shareFriend_btn,egret.TouchEvent.TOUCH_TAP,this,this.shareFriend),this.addEvent(this.shareGroup_btn,egret.TouchEvent.TOUCH_TAP,this,this.shareGroup),this.addEvent(this.shareUrl_btn,egret.TouchEvent.TOUCH_TAP,this,this.shareUrl)},e.prototype.shareFriend=function(){egret.ExternalInterface.call("sendToNative","shareFriend$"+GameData.UserInfo.invitation_code)},e.prototype.shareGroup=function(){egret.ExternalInterface.call("sendToNative","shareGroup$"+GameData.UserInfo.invitation_code)},e.prototype.shareUrl=function(){egret.ExternalInterface.call("sendToNative","copyStr$"+GameData.UserInfo.invitation_code)},e}(cor.BaseScene);t.GameShare=e,__reflect(e.prototype,"Game.GameShare")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(e){var n=t.call(this)||this;return n.skinName="GetPrize",n.init(e),n.initEvent(),n}return __extends(e,t),e.prototype.init=function(t){this.prize_group.x=this.width/2,this.prizeNum.text=t+""},e.prototype.initEvent=function(){this.addEvent(this.hideGroup,egret.TouchEvent.TOUCH_TAP,this,this.showMove)},e.prototype.showMove=function(){var t=this;this.hideGroup.visible=!1,egret.Tween.get(this.prize_group).to({x:this.width-263,y:41,scaleX:.2,scaleY:.2},500).call(function(){t.dispose()})},e}(cor.BaseScene);t.GetPrize=e,__reflect(e.prototype,"Game.GetPrize")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(e){var n=t.call(this)||this;return n.skinName="GoodsInfo",n.init(e),n.initEvent(),n}return __extends(e,t),e.prototype.init=function(t){this.goods_name.text=t.name,this.goods_desc.text=t.description,this.goods_img.source=t.id_card},e.prototype.initEvent=function(){this.addEvent(this.back_btn,egret.TouchEvent.TOUCH_TAP,this,this.dispose)},e}(cor.BaseScene);t.GoodsInfo=e,__reflect(e.prototype,"Game.GoodsInfo")}(Game||(Game={}));var Game;!function(t){var e=function(t){function e(e,n,i){var r=t.call(this)||this;return r.skinName="headComment",r.init(n,i),r.initEvent(e),r}return __extends(e,t),e.prototype.init=function(t,e){this.gst_num.text=GameData.UserInfo.gts_number+"",this.mine_num.text=GameData.UserInfo.mineral+"",this.title.text=t,this.title_en.text=e},e.prototype.initEvent=function(t){var e=this;this.addEvent(this.back_btn,egret.TouchEvent.TOUCH_TAP,this,function(){e.dispose(),t.dispose()}),this.addEvent(cor.EventManage.instance(),UpdataGameInfo,this,this.updata_gameinfo)},e.prototype.updata_gameinfo=function(){this.gst_num.text=GameData.UserInfo.gts_number+"",this.mine_num.text=GameData.UserInfo.mineral+""},e}(cor.BaseScene);t.headComment=e,__reflect(e.prototype,"Game.headComment")}(Game||(Game={}));var Game;!function(t){var e=function(e){function n(t){var n=e.call(this)||this;return n.skinName="MineArea",n._configdata=[{id:8,user_hold_area_id:2,good_id:6,good_type:2,status:1,created_at:"2020-08-10 23:06:50",updated_at:"2020-08-10 23:06:50",good:{id:6,name:"淘洗机器",type:2,id_card:"taoxijiqi",price:"10.00",content:{every_min_use_fuel_value:"0.001"},description:"淘洗机器",is_can_buy:1,buy_user_type:2,remark:null,status:1,sort:0,created_at:"2020-08-08 22:18:30",updated_at:"2020-08-08 22:18:30"}}],n.init(t),n.initEvent(),n}return __extends(n,e),n.prototype.init=function(e){this.head_group.addChild(new t.headComment(this,"矿区","MINING AREA")),this.bg.source="Bg_MiningArea_Lv"+GameData.UserInfo.current_hold_area_grade+"_png",this._configdata=e,this.area_grade.text=GameData.UserInfo.current_hold_area_code+"矿区：v"+GameData.UserInfo.current_hold_area_grade,Log(e),this.config_engine(),this.check_start_btn_state()},n.prototype.config_engine=function(){this.config_excavate_engine_btn.visible=!0;var t=this._configdata,e=0;for(var n in t){var i=t[n];i.good_type==ENGINE_TYPE.PANNING?(this.panning_engine.visible=!0,this.config_panning_engine_btn.visible=!1):(this["excavate_engine"+e].source=i.good.id_card,this["excavate_engine"+e].visible=!0,this["excavate_engine"+e].name=i.id,e++)}(this.config_panning_engine_btn.visible||5==e||-1!=GameData.UserInfo.dig_time)&&(this.config_excavate_engine_btn.visible=!1)},n.prototype.initEvent=function(){var t=this;this.addEvent(this.config_panning_engine_btn,egret.TouchEvent.TOUCH_TAP,this,this.showExcavate,[ENGINE_TYPE.PANNING]),this.addEvent(this.config_excavate_engine_btn,egret.TouchEvent.TOUCH_TAP,this,this.showExcavate,[ENGINE_TYPE.EXCAVATE]),this.addEvent(this.start_dig_btn,egret.TouchEvent.TOUCH_TAP,this,this.start_dig),this.addEvent(this.select_close_btn,egret.TouchEvent.TOUCH_TAP,this,function(){t.select_group.visible=!1}),this.addEvent(this.warehouseList,eui.ItemTapEvent.ITEM_TAP,this,this.intall_excavate_engine),this.addEvent(cor.EventManage.instance(),DigMineTime,this,this.check_start_btn_state)},n.prototype.showExcavate=function(t){var e=this;cor.Socket.getIntance().sendmsg("USER_GOOD_LIST",{},function(n){Log(n);var i=[];for(var r in n)n[r].good.type==t&&i.push(n[r]);e.warehouseList.dataProvider=new eui.ArrayCollection(i),e.select_group.visible=!0},this)},n.prototype.intall_excavate_engine=function(t){var e=this,n=t.item.id,i=t.item.good.type==ENGINE_TYPE.EXCAVATE?"CONFIG_EXCAVATE_ENGINE":"CONFIG_PANNING_ENGINE";cor.Socket.getIntance().sendmsg(i,{user_good_id:n},function(t){e.select_group.visible=!1,Log(t),e.refresh()},this)},n.prototype.refresh=function(){var t=this;cor.Socket.getIntance().sendmsg("GET_USER_HOLD_AREA_CONFIG",{},function(e){Log(e),t._configdata=e,t.config_engine()},this)},n.prototype.start_dig=function(){var e=this;-1==GameData.UserInfo.dig_time?cor.Socket.getIntance().sendmsg("USER_HOLD_AREA_START",{},function(n){Log(n),t.TipsSkin.instance().show("开始挖矿"),GameData.UserInfo.dig_time=14400,e.config_excavate_engine_btn.visible=!1,e.check_start_btn_state(),cor.EventManage.instance().sendEvent(StartDigMine)},this):0==GameData.UserInfo.dig_time},n.prototype.check_start_btn_state=function(){-1==GameData.UserInfo.dig_time?(this.start_dig_btn.tx.text="开始挖矿",this.start_dig_btn.tx.stroke=2):0==GameData.UserInfo.dig_time?(this.start_dig_btn.tx.text="\b领取奖励",this.start_dig_btn.tx.stroke=2):(this.start_dig_btn.tx.text="领取奖励倒计时:\n"+numberToTime(1e3*GameData.UserInfo.dig_time,1),this.start_dig_btn.tx.stroke=0)},n}(cor.BaseScene);t.MineArea=e,__reflect(e.prototype,"Game.MineArea")}(Game||(Game={}));var Game;!function(t){var e=function(e){function n(t){var n=e.call(this)||this;return n.skinName="MineManager",n._minedata=[{id:1,name:"V1矿区",total_output:2e3,price:"0.01",description:"V1矿区",grade:1,max_user:5,surplus:100,is_can_buy:!0}],n.init(t),n.initEnent(),n}return __extends(n,e),n.prototype.init=function(e){this.head_group.addChild(new t.headComment(this,"矿区管理","ADMINISTRATIVE OFFICE")),this._currentIndex=0,this._minedata=e,this.showMineInfo(),GameData.UserInfo.identity==IDENTITY.Owner&&this.setbuyBtnGray()},n.prototype.initEnent=function(){this.addEvent(this.last_btn,egret.TouchEvent.TOUCH_TAP,this,this.showLastMine),this.addEvent(this.next_btn,egret.TouchEvent.TOUCH_TAP,this,this.showNextMine),this.addEvent(this.buy_btn,egret.TouchEvent.TOUCH_TAP,this,this.buyMine)},n.prototype.showMineInfo=function(){this.removeDB();var t=this._minedata[this._currentIndex];this.surplus.text="剩余:"+t.surplus,this.mine_name.text=t.name,this.description.text=t.description,this.total_output.text=t.total_output+"",this.mine_area_bg.source="Banner_Kuangquguanli_lv."+t.grade+"_png",this.role.source="Lv."+t.grade+"_png",this.addDB(this.role_group,"Lv"+t.grade),this.price.text=t.price.split(".")[0]+"GST",this.buy_btn.label=t.is_can_buy?"购买":"已售罄",t.is_can_buy?this.setbuyBtnNormal():this.setbuyBtnGray(),this.checkLANbtn()},n.prototype.checkLANbtn=function(){this.last_btn.visible=this._currentIndex>0,this.next_btn.visible=this._currentIndex<this._minedata.length-1},n.prototype.showLastMine=function(){this._currentIndex--,this.showMineInfo()},n.prototype.showNextMine=function(){this._currentIndex++,this.showMineInfo()},n.prototype.setbuyBtnNormal=function(){GameData.UserInfo.identity!=IDENTITY.Owner&&(this.buy_btn.filters=[])},n.prototype.setbuyBtnGray=function(){var t=[.3,.3,0,0,0,.3,.3,0,0,0,.3,.3,0,0,0,0,0,0,1,0],e=new egret.ColorMatrixFilter(t);this.buy_btn.filters=[e]},n.prototype.buyMine=function(){var e=this;if(GameData.UserInfo.identity==IDENTITY.Owner)return void t.TipsSkin.instance().show("您已是矿主");var n=this._minedata[this._currentIndex];if(!n.is_can_buy)return void t.TipsSkin.instance().show("已售罄");var i=this._minedata[this._currentIndex].id,r=this._minedata[this._currentIndex].grade,o=Number(this._minedata[this._currentIndex].price.split(".")[0]);cor.Socket.getIntance().sendmsg("BUY_HOLD_AREA",{hold_area_id:i},function(n){t.TipsSkin.instance().show("购买成功"),GameData.UserInfo.gts_number-=o,GameData.UserInfo.current_hold_area_grade=r,GameData.UserInfo.identity=IDENTITY.Owner,cor.EventManage.instance().sendEvent(ChangeIdentity),cor.EventManage.instance().sendEvent(UpdataGameInfo),e.dispose()},this)},n}(cor.BaseScene);t.MineManager=e,__reflect(e.prototype,"Game.MineManager")}(Game||(Game={}));var Game;!function(t){var e=function(e){function i(t){var n=e.call(this)||this;return n.skinName="MinerServerCenter",n.init(t),n.initEvent(),n}return __extends(i,e),i.prototype.init=function(e){this.addDB(this.role_group,"Lv1"),this.head_group.addChild(new t.headComment(this,"矿\b工管理处","MINER")),this._minerserverInfo=e,this.ownerList.itemRenderer=n;for(var i in e)e[i].code=e[i].code+"矿区",e[i].user_nickname="矿主："+e[i].user_nickname,e[i].name="矿区等级："+e[i].name,e[i].miner_num=e[i].current_work_count+"/"+e[i].max_work_count,e[i].state=1;this.ownerList.dataProvider=new eui.ArrayCollection(e)},i.prototype.initEvent=function(){},i}(cor.BaseScene);t.MinerServerCenter=e,__reflect(e.prototype,"Game.MinerServerCenter");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="OwnerItem",e._leftTime=144e5,e._time_inter=-1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.removeFromStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.btn_touch,this)},e.prototype.btn_touch=function(t){switch(this.data.state){case 1:Log("开始挖矿");break;case 2:Log("领取收益");break;case 3:case 4:}},e.prototype.checkbtn=function(){var t=this;this.time_group.visible=!1;var e=[.3,.3,0,0,0,.3,.3,0,0,0,.3,.3,0,0,0,0,0,0,1,0],n=new egret.ColorMatrixFilter(e);switch(this.btn.filters=[],this.data.state){case 1:this.btn.wz.text="开始挖矿",this.btn.wz.textColor=16777215,this.btn.wz.stroke=2,this.btn.wz.strokeColor=5404393;break;case 2:this.btn.wz.text="领取收益",this.btn.wz.textColor=16777215,this.btn.wz.stroke=2,this.btn.wz.strokeColor=15308370;break;case 3:this.btn.filters=[n],this.btn.wz.text="",this.time_group.visible=!0,this.time.text=numberToTime(this._leftTime,1),this._time_inter=setInterval(function(){t._leftTime-=1e3,t.time.text=numberToTime(t._leftTime,1)},1e3);break;case 4:this.btn.filters=[n],this.btn.wz.text="已满"}},e.prototype.removeFromStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStage,this),this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.removeFromStage,this),this.btn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.btn_touch,this),clearInterval(this._time_inter)},e.prototype.dataChanged=function(){this.checkbtn()},e}(eui.ItemRenderer);__reflect(n.prototype,"OwnerItem")}(Game||(Game={}));var Game;!function(t){var e=function(e){function n(t){var n=e.call(this)||this;return n.skinName="ToolInfo",n.init(t),n.initEvent(),n}return __extends(n,e),n.prototype.init=function(t){this.goods_name.text=t.name,this.goods_desc.text=t.description,this.goods_img.source=t.id_card,this.buy_one_btn.label=t.price,this._goodsId=t.id,this.goods_num.text="1"},n.prototype.initEvent=function(){this.addEvent(this.back_btn,egret.TouchEvent.TOUCH_TAP,this,this.dispose),this.addEvent(this.buy_one_btn,egret.TouchEvent.TOUCH_TAP,this,this.buy_one),this.addEvent(this.sub_btn,egret.TouchEvent.TOUCH_TAP,this,this.sub),this.addEvent(this.add_btn,egret.TouchEvent.TOUCH_TAP,this,this.add)},n.prototype.add=function(){var t=Number(this.goods_num.text);10>t&&(t++,this.goods_num.text=t+"")},n.prototype.sub=function(){var t=Number(this.goods_num.text);t>1&&(t--,this.goods_num.text=t+"")},n.prototype.buy_one=function(){var e=this,n=Number(this.goods_num.text),i=Number(this.buy_one_btn.label.split("GST")[0])*n;cor.Socket.getIntance().sendmsg("BUY_GOOD",{good_id:this._goodsId,number:n},function(n){t.TipsSkin.instance().show("租用成功"),GameData.UserInfo.gts_number-=i,cor.EventManage.instance().sendEvent(UpdataGameInfo),e.dispose()},this)},n}(cor.BaseScene);t.ToolInfo=e,__reflect(e.prototype,"Game.ToolInfo")}(Game||(Game={}));var Game;!function(t){var e=function(e){function n(t){var n=e.call(this)||this;return n.skinName="ToolsStore",n._toolsdata=[],n.init(t),n.initEnent(),n}return __extends(n,e),n.prototype.init=function(e){this.head_group.addChild(new t.headComment(this,"工具商店","TOOL SHOP")),this._toolsdata=[];for(var n in e)if(0==e[n].buy_user_type||e[n].buy_user_type==GameData.UserInfo.identity){this._toolsdata.push(e[n]);var i=this._toolsdata.length-1;this._toolsdata[i].price=e[n].price.split(".")[0]+"GST"}this.toolsList.dataProvider=new eui.ArrayCollection(this._toolsdata)},n.prototype.initEnent=function(){this.addEvent(this.toolsList,eui.ItemTapEvent.ITEM_TAP,this,this.toolsInfo)},n.prototype.toolsInfo=function(e){this.addChild(new t.ToolInfo(e.item))},n}(cor.BaseScene);t.ToolsStore=e,__reflect(e.prototype,"Game.ToolsStore")}(Game||(Game={}));var Game;!function(t){var e=function(e){function n(t){var n=e.call(this)||this;return n.skinName="Warehouse",n._warehousedata=[],n.init(t),n.initEnent(),n}return __extends(n,e),n.prototype.init=function(e){this.head_group.addChild(new t.headComment(this,"仓库","WAREHOUSE"));for(var n in e)3==e[n].good.type?e[n].total=e[n].content.value+"吨":e[n].total=e[n].total+"个";this.warehouseList.dataProvider=new eui.ArrayCollection(e)},n.prototype.initEnent=function(){this.addEvent(this.warehouseList,eui.ItemTapEvent.ITEM_TAP,this,this.goodsInfo)},n.prototype.goodsInfo=function(e){this.addChild(new t.GoodsInfo(e.item.good))},n}(cor.BaseScene);t.Warehouse=e,__reflect(e.prototype,"Game.Warehouse")}(Game||(Game={}));var core;!function(t){var e=function(){function t(){}return t.sendPostData=function(t,e,n,r){if(r)game.Socket.getIntance().sendmsg(t,e,n,r);else{var o=new i;o.sendPostData(t,e,n)}},t.sendGetData=function(t,e,n,i,o){if(void 0===o&&(o=!1),i)game.Socket.getIntance().sendmsg(t,e,n,i,o);else{var s=new r;s.sendGetData(t,e,n)}},t}();t.Http=e,__reflect(e.prototype,"core.Http");var n=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddedToStage,e),e}return __extends(e,t),e.prototype.onAddedToStage=function(t){this.touchEnabled=!0,this.width=GameData.GameWidth,this.height=GameData.GameHeigth,this.addChild(createRect(0,0,this.width,this.height,.6))},e.prototype.createan=function(){this.loading=createBitmap("loadingIcon_png"),this.loading.x=this.width/2,this.loading.y=this.height/2,this.addChild(this.loading),egret.Tween.get(this.loading,{loop:!0}).to({rotation:360},500)},e.prototype.show=function(){this.alpha=0;var t=this;this.timeoutInt=setTimeout(function(){t.alpha=1,clearTimeout(t.timeoutInt)},500)},e.prototype.hide=function(){clearTimeout(this.timeoutInt),this.visible=!1},e.getInstance=function(){return null==this._ins&&(this._ins=new e),this._ins},e._ins=null,e}(egret.DisplayObjectContainer);t.Covershap=n,__reflect(n.prototype,"core.Covershap");var i=function(){function e(){}return e.prototype.sendPostData=function(e,n,i){function r(){d.removeEventListener(egret.Event.COMPLETE,r,this),d.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this);var n=JSON.parse(d.response.substring());if(Log("getMessage",e,n),1==n.code){d=new egret.HttpRequest,d.responseType=egret.HttpResponseType.TEXT,d.setRequestHeader("Content-Type","application/text;charset=UTF-8"),a=GameData.ServerUrl+"refreshLogin",d.open(a,"POST");var h={refreshToken:""};d.send(JSON.stringify(h)),d.addEventListener(egret.Event.COMPLETE,o,this),d.addEventListener(egret.IOErrorEvent.IO_ERROR,s,this)}else t.Covershap.getInstance().hide(),i(n)}function o(t){d.removeEventListener(egret.Event.COMPLETE,o,this),d.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this);var n=JSON.parse(d.response.substring());Log("getMessage","refreshLogin",n),0==n.code?(c.token=n.data.token,h.sendPostData(e,c,i)):2==n.code&&(Log(n.errMsg),window.location.reload())}function s(t){Log("onGetIOError_"+t.target._url)}var a,h=this,c=n;a=GameData.ServerUrl+e,a=a.replace("ws","http");var u=/cnrgame\/websocket|cnrGame\/websocket/;a=a.replace(u,""),n=JSON.stringify(n),Log("sendMessage",e,n);var d=new egret.HttpRequest;d.responseType=egret.HttpResponseType.TEXT,d.setRequestHeader("Content-Type","application/text;charset=UTF-8"),d.open(a,"POST"),d.send(n),d.addEventListener(egret.Event.COMPLETE,r,this),d.addEventListener(egret.IOErrorEvent.IO_ERROR,s,this),t.Covershap.getInstance().show()},e}();__reflect(i.prototype,"HttpPost");var r=function(){function t(){}return t.prototype.sendGetData=function(t,e,n){function i(){g.removeEventListener(egret.Event.COMPLETE,i,this),g.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this);var e=JSON.parse(g.response.substring());if(Log("getMessage",t,e),1==e.code){g=new egret.HttpRequest,g.responseType=egret.HttpResponseType.TEXT,g.setRequestHeader("Content-Type","application/plain;charset=UTF-8"),s=GameData.ServerUrl+"refreshLogin",g.open(s,"POST");var a={refreshToken:""};g.send(JSON.stringify(a)),g.addEventListener(egret.Event.COMPLETE,r,this),g.addEventListener(egret.IOErrorEvent.IO_ERROR,o,this)}else n(e)}function r(e){g.removeEventListener(egret.Event.COMPLETE,r,this),g.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this);var i=JSON.parse(g.response.substring());Log("getMessage","refreshLogin",i),0==i.code?(h.token=i.data.token,a.sendGetData(t,h,n)):2==i.code&&(Log(i.errMsg),window.location.reload())}function o(t){Log("onGetIOError_"+t.target._url)}var s,a=this,h=e;s=GameData.ServerUrl+t,Log("sendMessage",t,e);var c,u="",d=0;for(c in e)d>0&&(u+="&"),u+=c+"="+e[c],d++;var g=new egret.HttpRequest;s=s+"?"+u,g=new egret.HttpRequest,g.responseType=egret.HttpResponseType.TEXT,g.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),g.open(s,"GET"),g.send(),g.addEventListener(egret.Event.COMPLETE,i,this),g.addEventListener(egret.IOErrorEvent.IO_ERROR,o,this)},t}();__reflect(r.prototype,"HttpGet")}(core||(core={}));var game;!function(t){var e=function(){function t(){this.bconnect=!1,this.breflesh=!1,this.breLogin=!1,this.inteval=-1,this.firstConnect=!0,this.loginSuccess=!1,this.bconnecting=!1,this.heartCount=0,this.reSendTimesCount=0,this.HeartTag=-1,this.connectCount=0,this.breLogin=!1,this.param=[],this.webSocket=null,this.firstConnect=!0}return t.prototype.connect=function(t){Game.TipsSkin.instance().show("connet...",!1),this.webSocket=new egret.WebSocket,this.webSocket.type=egret.WebSocket.TYPE_BINARY,this.webSocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.webSocket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.webSocket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),Log("url=====",t),this.webSocket.connectByUrl(t)},t.prototype.onReceiveMessage=function(t){var e=new egret.ByteArray;this.webSocket.readBytes(e);var n=(e.buffer.byteLength,this.byteToString(e.bytes));if(-1!=n.indexOf("#HeartBeat$"))return Log("心跳响应:",n),void this.heartCount--;var i;if(Game.TipsSkin.instance().hide(),Log(JSON.parse(i)),this.param.length>0){var r=this.param[0].callback,o=this.param[0].obj;this.param=[],r.apply(o,[JSON.parse(i)])}},t.prototype.sendByteMsg=function(t,e,n,i,r){if(void 0===r&&(r=!0),!(this.param.length>0)){r&&Game.TipsSkin.instance().show("waiting....",!1);var o={action:t,msg:e,callback:n,targetObj:i};e="#"+t+"$"+JSON.stringify(e)+"$#";var s=this.stringToByte(e);this.webSocket.writeBytes(s),this.webSocket.flush(),null!=n&&this.param.push(o)}},t.prototype.byteToString=function(t){if("string"==typeof t)return t;for(var e="",n=t,i=0;i<n.length;i++){var r=n[i].toString(2),o=r.match(/^1+?(?=0)/);if(o&&8==r.length){for(var s=o[0].length,a=n[i].toString(2).slice(7-s),h=1;s>h;h++)a+=n[h+i].toString(2).slice(2);e+=String.fromCharCode(parseInt(a,2)),i+=s-1}else e+=String.fromCharCode(n[i])}return e},t.prototype.stringToByte=function(t){var e,n,i=new egret.ByteArray;e=t.length;for(var r=0;e>r;r++)n=t.charCodeAt(r),n>=65536&&1114111>=n?(i.writeByte(n>>18&7|240),i.writeByte(n>>12&63|128),i.writeByte(n>>6&63|128),i.writeByte(63&n|128)):n>=2048&&65535>=n?(i.writeByte(n>>12&15|224),i.writeByte(n>>6&63|128),i.writeByte(63&n|128)):n>=128&&2047>=n?(i.writeByte(n>>6&31|192),i.writeByte(63&n|128)):i.writeByte(255&n);return i},t.prototype.sendmsg=function(t,e,n,i,r){for(var o={action:t,param:e,callback:n,targetObj:i},s=!1,a=0;a<this.param.length;a++)if(this.param[a]&&this.param[a].action==o.action){s=!0;break}s||this.param.push(o);var h=JSON.stringify(e);return h=t+":"+h,Log("发送数据："+h),this.bconnect?(this.webSocket.writeUTF(h),r||core.Covershap.getInstance().show()):(core.Covershap.getInstance().show(),this.onSocketClose()),this.webSocket.connected?void 0:void core.Covershap.getInstance().hide()},t.prototype.sendHeart=function(){if(this.bconnecting&&(this.heartCount>=3&&(Log("心跳3次没反应，主动断线重连"),this.webSocket.close(),this.heartCount=0,this.bconnecting=!1),this.webSocket.connected)){var t="#HeartBeat$?$#",e=this.stringToByte(t);this.webSocket.writeBytes(e),this.webSocket.flush(),this.heartCount++}},t.prototype.onSocketOpen=function(){if(Log("webSocket连接成功"),this.connectCount=0,Game.TipsSkin.instance().hide(),this.bconnecting=!0,this.bconnect=!0,this.breflesh){this.breflesh=!1,this.param=[];var t;if(this.param.length>0){var e=this.param[0].action;t=this.param[0].msg;var n=this.param[0].callback,i=this.param[0].targetObj;Log("重连发送数据："+t),this.param=[],this.sendByteMsg(e,t,n,i)}}else this.breLogin&&(this.breLogin=!1,this.LoginGame())},t.prototype.onReceiveMessageT=function(t){var e=this.webSocket.readUTF(),n=e.indexOf(":");if(-1==n)return void this.webSocket.close();var i=e.substr(0,n),r=JSON.parse(e.substr(n+1));if(Log("收到数据：","Action: ",i),Log(r),-1!=this.inteval&&clearTimeout(this.inteval),401!=r.code){if(404==r.code)return void this.webSocket.close();for(var o=0;o<this.param.length;o++){var s=this.param[o];if(s&&i==s.action){var a=s.targetObj,h=s.callback;this.param[o]=null,h.apply(a,[r])}}for(var o=this.param.length-1;o>=0;o--){var s=this.param[o];null==s&&this.param.splice(o,1)}this.firstConnect&&(this.firstConnect=!1)}else{core.Covershap.getInstance().hide()}},t.prototype.onSocketClose=function(){this.connectCount++,Log("重连++++++",this.connectCount,"次"),this.connectCount>=12?(this.connectCount=0,Game.TipsSkin.instance().show("connect fail")):this.refreshLogin()},t.prototype.refreshLogin=function(){core.Covershap.getInstance().show(),this.breflesh=!0,this.webSocket.connectByUrl(GameData.ServerSocketUrl)},t.prototype.RLogin=function(){this.webSocket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.webSocket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.webSocket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.connectCount=0,this.param=[],this.breLogin=!0,this.webSocket=null,this.connect("")},t.prototype.LoginGame=function(){},t.prototype.changeUrl=function(){this.webSocket.close(),this.webSocket.connectByUrl(GameData.ServerSocketUrl)},t.getIntance=function(){return this._i=this._i||new t},t._i=null,t}();t.Socket=e,__reflect(e.prototype,"game.Socket")}(game||(game={}));var cor;!function(t){var e=function(){function e(){this.bconnect=!1,this.breflesh=!1,this.breLogin=!1,this.inteval=-1,this.firstConnect=!0,this.reSendTimesCount=0,this._bchange=!1,this.connectCount=0,this.breLogin=!1,this.param=[],this.webSocket=null,this.firstConnect=!0}return e.prototype.ProConnet=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return[2,new Promise(function(e,n){t.connect(function(){e()},t)})]})})},e.prototype.connect=function(t,e){Game.TipsSkin.instance().show("连接网络...",!1),Log("连接：",GameData.ServerSocketUrl),this.webSocket=new egret.WebSocket,this.webSocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.webSocket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.webSocket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.webSocket.connectByUrl(GameData.ServerSocketUrl),this.connetCB=t,this.connetObj=e},e.prototype.sendmsg=function(t,e,n,i,r){if(!this.webSocket.connected)return Game.TipsSkin.instance().show("网络重连中..."),void this.refreshLogin();for(var o={action:t,param:e,callback:n,targetObj:i},s=!1,a=0;a<this.param.length;a++)if(this.param[a]&&this.param[a].action==o.action){s=!0;break}s||this.param.push(o);var h={cmd:t,data:e,msg:""},c=JSON.stringify(h);Log("发送数据："+JSON.stringify(c)),this.webSocket.connected&&(this.webSocket.writeUTF(c),r||(core.Covershap.getInstance().show(),this.inteval=setTimeout(function(){core.Covershap.getInstance().hide()},1e4)))},e.prototype.onSocketOpen=function(){console.log("连接websocket成功"),Game.TipsSkin.instance().hide(),this.connetCB.apply(this.connetObj),this.param=[],this._bchange=!1,this.breflesh&&(this.breflesh=!1,t.Socket.getIntance().sendmsg("LOGIN",{mobile:GameData.UserPhone,password:GameData.UserPassword},function(t){},this))},e.prototype.onReceiveMessage=function(e){var n=this.webSocket.readUTF();Log(n);var i=JSON.parse(n);switch(i.cmd){case"NEW_NOTICE":return void t.EventManage.instance().sendEvent(NEW_NOTICE,i.data)}for(var r=0;r<this.param.length;r++){var o=this.param[r];if(o&&o.action==i.cmd){var s=i.data;core.Covershap.getInstance().hide(),clearTimeout(this.inteval),0==i.code?o.callback.apply(o.targetObj,[s]):(Log("报错啦：",i.code),Game.TipsSkin.instance().show(i.msg)),this.param.splice(r,1);break}}},e.prototype.onSocketClose=function(){this.connectCount++,Log("重连++++++",this.connectCount,"次"),this.connectCount>=12?(this.connectCount=0,core.Covershap.getInstance().hide()):this.refreshLogin()},e.prototype.refreshLogin=function(){core.Covershap.getInstance().show(),this._bchange||(this.breflesh=!0),this.webSocket.connectByUrl(GameData.ServerSocketUrl)},e.prototype.changeUrl=function(){this._bchange=!0,this.webSocket.close()},e.getIntance=function(){return this._i=this._i||new e},e._i=null,e}();t.Socket=e,__reflect(e.prototype,"cor.Socket")}(cor||(cor={}));